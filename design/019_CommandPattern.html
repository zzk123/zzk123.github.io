<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>命令模式 | Koala &#39;s blog</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="欢迎来到我的博客">
    <link rel="preload" href="/assets/css/0.styles.0dca6718.css" as="style"><link rel="preload" href="/assets/js/app.193c9b61.js" as="script"><link rel="preload" href="/assets/js/2.be286493.js" as="script"><link rel="preload" href="/assets/js/35.fd8c8f14.js" as="script"><link rel="prefetch" href="/assets/js/10.d195f939.js"><link rel="prefetch" href="/assets/js/11.dd42e2a6.js"><link rel="prefetch" href="/assets/js/12.ee2c872c.js"><link rel="prefetch" href="/assets/js/13.788181fe.js"><link rel="prefetch" href="/assets/js/14.923b40d7.js"><link rel="prefetch" href="/assets/js/15.be1e8f2a.js"><link rel="prefetch" href="/assets/js/16.a5861f2e.js"><link rel="prefetch" href="/assets/js/17.0ca1cca8.js"><link rel="prefetch" href="/assets/js/18.3552af88.js"><link rel="prefetch" href="/assets/js/19.d0b598dd.js"><link rel="prefetch" href="/assets/js/20.312fba46.js"><link rel="prefetch" href="/assets/js/21.de99e5de.js"><link rel="prefetch" href="/assets/js/22.4cb1ef09.js"><link rel="prefetch" href="/assets/js/23.2e9ea85a.js"><link rel="prefetch" href="/assets/js/24.1cd100b8.js"><link rel="prefetch" href="/assets/js/25.c17ed571.js"><link rel="prefetch" href="/assets/js/26.cee42a14.js"><link rel="prefetch" href="/assets/js/27.34b9e8bb.js"><link rel="prefetch" href="/assets/js/28.a0fd1666.js"><link rel="prefetch" href="/assets/js/29.cc16a8ba.js"><link rel="prefetch" href="/assets/js/3.e2b53d75.js"><link rel="prefetch" href="/assets/js/30.4b4a9808.js"><link rel="prefetch" href="/assets/js/31.55d17ac2.js"><link rel="prefetch" href="/assets/js/32.e6285297.js"><link rel="prefetch" href="/assets/js/33.2cf9fcd0.js"><link rel="prefetch" href="/assets/js/34.549b5096.js"><link rel="prefetch" href="/assets/js/36.db162c08.js"><link rel="prefetch" href="/assets/js/37.f105831d.js"><link rel="prefetch" href="/assets/js/38.d42b82e0.js"><link rel="prefetch" href="/assets/js/39.eb81783f.js"><link rel="prefetch" href="/assets/js/4.2837b6be.js"><link rel="prefetch" href="/assets/js/40.87c4c789.js"><link rel="prefetch" href="/assets/js/41.fc9b4279.js"><link rel="prefetch" href="/assets/js/42.c9148681.js"><link rel="prefetch" href="/assets/js/43.dbe26f4f.js"><link rel="prefetch" href="/assets/js/44.b1d85a5c.js"><link rel="prefetch" href="/assets/js/45.5a1e6a7a.js"><link rel="prefetch" href="/assets/js/46.bd963e4a.js"><link rel="prefetch" href="/assets/js/47.f6e86edc.js"><link rel="prefetch" href="/assets/js/48.bdbc5c65.js"><link rel="prefetch" href="/assets/js/49.65ae461d.js"><link rel="prefetch" href="/assets/js/5.3f71247d.js"><link rel="prefetch" href="/assets/js/50.66be60b2.js"><link rel="prefetch" href="/assets/js/51.42b1c641.js"><link rel="prefetch" href="/assets/js/52.bb9f5b94.js"><link rel="prefetch" href="/assets/js/53.3ed95f43.js"><link rel="prefetch" href="/assets/js/54.b989fa99.js"><link rel="prefetch" href="/assets/js/55.7799c2bd.js"><link rel="prefetch" href="/assets/js/56.95e3d2fa.js"><link rel="prefetch" href="/assets/js/57.47649eef.js"><link rel="prefetch" href="/assets/js/58.c3ce9734.js"><link rel="prefetch" href="/assets/js/59.1e092fb4.js"><link rel="prefetch" href="/assets/js/6.ba15ebf3.js"><link rel="prefetch" href="/assets/js/60.ae57b5f2.js"><link rel="prefetch" href="/assets/js/61.68ecf247.js"><link rel="prefetch" href="/assets/js/62.42a2fc04.js"><link rel="prefetch" href="/assets/js/63.819b8db9.js"><link rel="prefetch" href="/assets/js/64.8034f4d3.js"><link rel="prefetch" href="/assets/js/65.fa291912.js"><link rel="prefetch" href="/assets/js/66.3db4dcf7.js"><link rel="prefetch" href="/assets/js/67.a66d7e55.js"><link rel="prefetch" href="/assets/js/68.cbaf17d3.js"><link rel="prefetch" href="/assets/js/7.6f9d368d.js"><link rel="prefetch" href="/assets/js/8.516fa0e1.js"><link rel="prefetch" href="/assets/js/9.f1946ce5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0dca6718.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container custom-page-class"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Koala 's blog</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          Home
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/design/" class="router-link-active">
          设计模式
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/algorithm/">
          算法相关
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          java相关
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/design/001_Preface.html" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>创建者模式</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>结构性模式</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>行为性模式</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/017_BehavioralPattern.html" class="sidebar-link">介绍</a></li><li><a href="/design/018_ChainofResponsibilityPattern.html" class="sidebar-link">职责链模式</a></li><li><a href="/design/019_CommandPattern.html" class="active sidebar-link">命令模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#结构图" class="sidebar-link">结构图</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#典型代码" class="sidebar-link">典型代码</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#例子：自定义功能键的开发" class="sidebar-link">例子：自定义功能键的开发</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#命令队列的实现" class="sidebar-link">命令队列的实现</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#例子：撤销操作的实现" class="sidebar-link">例子：撤销操作的实现</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#请求日志" class="sidebar-link">请求日志</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#例子：网站配置文件管理工具" class="sidebar-link">例子：网站配置文件管理工具</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#宏命令" class="sidebar-link">宏命令</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#主要优点" class="sidebar-link">主要优点</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#主要缺点" class="sidebar-link">主要缺点</a></li><li class="sidebar-sub-header"><a href="/design/019_CommandPattern.html#适用场景" class="sidebar-link">适用场景</a></li></ul></li><li><a href="/design/020_InterpreterPattern.html" class="sidebar-link">解释器模式</a></li><li><a href="/design/021_MediatorPattern.html" class="sidebar-link">中介者模式</a></li><li><a href="/design/022_MementoPattern.html" class="sidebar-link">备忘录模式</a></li><li><a href="/design/023_IteratorPattern.html" class="sidebar-link">迭代器模式</a></li><li><a href="/design/024_ObserverPattern.html" class="sidebar-link">观察者模式</a></li><li><a href="/design/025_StatePattern.html" class="sidebar-link">状态模式</a></li><li><a href="/design/026_StrategyPattern.html" class="sidebar-link">策略模式</a></li><li><a href="/design/027_Template_Method_Pattern.html" class="sidebar-link">模板方法模式</a></li><li><a href="/design/028_VisitorPattern.html" class="sidebar-link">访问者模式</a></li></ul></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h2 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h2> <p>在软件开发中，经常需要向某些对象发送请求(调用其中的某个或某些方法)，但是并不知道请求的接收者是谁，也不知道被请求的操作是哪个，此时，特别希望能够以一种松耦和的方式来设计软件，使得请求者和请求接受者能够消除彼此之间的耦合，让对象之间的嗲用关系更加灵活，可以灵活地指定请求接收者以及被请求地操作。命令模式为此类问题提供了一个较为完美地解决方案</p> <p>命令模式可以将请求发送者和接收者完全解耦，发送者与接收者之间没有直接引用关系，发送请求的对象只需要知道如何发送请求，而不必知道如何完成请求</p> <h2 id="定义"><a href="#定义" aria-hidden="true" class="header-anchor">#</a> 定义</h2> <blockquote><p>命令模式(Command Pattern)：将一个请求封装为一个对象，从而可用不同的请求客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。命令模式是一种对象行为型模式，其别名为动作(Action)模式或事务(Transaction)模式</p></blockquote> <h2 id="结构图"><a href="#结构图" aria-hidden="true" class="header-anchor">#</a> 结构图</h2> <p>命令模式的核心在于引入了命令类，通过命令类来降低发送者和接收者的耦合度，请求发送者只需指定一个命令对象，再通过命令对象来调用请求接收者的处理方法，其结构如下图：</p> <p><a data-fancybox="" title="结构图" href="/pic/design/fm5wMcI.png"><img src="/pic/design/fm5wMcI.png" alt="结构图"></a></p> <p><strong>在命令模式结构图中包含以下4个角色</strong></p> <ol><li><p><strong>Command(抽象命令类)</strong>：抽象命令类一般是一个抽象类或接口中，在其中声明了用于执行请求execute()等方法，通过这些方法可以调用请求接收者的相关操作</p></li> <li><p><strong>ConcreteCommand(具体命令类)</strong>:具体命令类是抽象命令类的子类，实现在抽象命令类中声明的方法，它对应具体的接收者对象，将接收者对象的动作都绑定在其中。在实现execute()方法时，将调用接收者对象的相关操作(Action)</p></li> <li><p><strong>Invoker(调用者)</strong>：调用者即请求发送者，它通过命令对象来执行请求。一个调用者并不需要在设计时确定其接收者，因此它只与抽象命令类之间存在关联关系。在程序运行时可以将一个具体命令对象注入其中，在调用具体命令对象的execute()方法，从而实现间接调用请求接收者的相关操作。</p></li> <li><p><strong>Receiver(接收者)</strong>：接收者执行与请求相关的操作，它具体实现对请求的业务处理</p></li></ol> <p><strong>命令模式的本质是对请求进行封装，一个请求对应于一个命令，将发出命令的责任和执行命令的责任分割开</strong>。每一个命令都是一个操作：请求的一方发出请求要求执行的一个操作；接收的一方收到请求，并执行相应的操作。命令模式允许请求的一方和接收的一方独立开来，使得请求的一方不必知道接收请求的一方的接口，更不必知道请求如何被接收，操作是否被执行，何时被执行，以及是怎么被执行的。</p> <p><strong>命令模式的关键在于引入了抽象命令类，请求发送者针对抽象命令类编程，只有实现了抽象命令类的具体命令才与请求接收者相关联</strong>。在最简单的抽象命令类中只包含了一个抽象的execute()方法，每个具体命令类将一个Receiver类型的对象作为一个实例变量进行存储，从而具体指定一个请求的接收者，不同的具体命令类提供了execute()方法的不同实现，并调用不同接收者的请求处理方法。</p> <h2 id="典型代码"><a href="#典型代码" aria-hidden="true" class="header-anchor">#</a> 典型代码</h2> <p>典型的抽象命令类代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	abstract class Command<span class="token punctuation">{</span>
		public abstract void execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>对于请求发送者即调用者而言，将针对抽象命令类进行编程，可以通过构造注入或者设值注入的方式在运行时传入具体命令类对象，并在业务方法中调用命令对象的execute()方法</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	class Invoker<span class="token punctuation">{</span>
		
		private Command <span class="token function">command</span><span class="token punctuation">;</span>

		//构造注入
		public Invoker<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span><span class="token punctuation">{</span>
			this.command <span class="token operator">=</span> <span class="token function">command</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>	

		//设值注入
		public void setCommand<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span><span class="token punctuation">{</span>
			this.command <span class="token operator">=</span> <span class="token function">command</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		//业务方法，用于调用命令类的execute<span class="token punctuation">(</span><span class="token punctuation">)</span>方法
		public void call<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			command.execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>具体命令类继承了抽象命令类，它与请求接收者相关联，实现了在抽象命令类中声明的execute()方法，并在实现时调用接收者的请求响应方法action(),其典型代码如下</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	class ConcreteCommand extends Command<span class="token punctuation">{</span>
		private Receiver receiver<span class="token punctuation">;</span>		//维持一个对请求接收者对象的引用
		
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			receiver.action<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			//调用请求接收者的业务处理方法action<span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>请求接收者Receiver类具体实现对请求的业务处理，它提供了action()方法，用于执行与请求相关的操作，其典型代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	class Receiver<span class="token punctuation">{</span>
		public void action<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			//具体操作
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h2 id="例子：自定义功能键的开发"><a href="#例子：自定义功能键的开发" aria-hidden="true" class="header-anchor">#</a> 例子：自定义功能键的开发</h2> <p>开发一个桌面版应用程序，该应用程序为用户提供一系列自定义功能键，用户可以通过这些功能键来实现一些快捷操作，为了降低功能键与功能处理类之间的耦合度，让用户可以自定义每一个功能键的功能，现使用命令模式来设计，结构图如下</p> <h3 id="结构图-2"><a href="#结构图-2" aria-hidden="true" class="header-anchor">#</a> 结构图</h3> <p><a data-fancybox="" title="结构图" href="/pic/design/FvrATPM.png"><img src="/pic/design/FvrATPM.png" alt="结构图"></a></p> <p>在图中,FBSettingWindow是‘功能键设置’界面类，FunctionButton充当请求调用者，Command充当抽象命令类，MinimizeCommand和HelpCommand充当具体命令类，WindowHandler 和 HelpHandler充当请求接收者</p> <h3 id="实现代码"><a href="#实现代码" aria-hidden="true" class="header-anchor">#</a> 实现代码</h3> <p><strong>功能键设置窗口类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class FBSettingWindow <span class="token punctuation">{</span>
		private String title<span class="token punctuation">;</span>
		private ArrayList<span class="token operator">&lt;</span>FunctionButton<span class="token operator">&gt;</span> functionButtons <span class="token operator">=</span> new ArrayList<span class="token operator">&lt;</span>FunctionButton<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		public FBSettingWindow<span class="token punctuation">(</span>String title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.title <span class="token operator">=</span> title<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		public String getTitle<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> title<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		public void setTitle<span class="token punctuation">(</span>String title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.title <span class="token operator">=</span> title<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		public ArrayList<span class="token operator">&lt;</span>FunctionButton<span class="token operator">&gt;</span> getFunctionButtons<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> functionButtons<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		public void setFunctionButtons<span class="token punctuation">(</span>ArrayList<span class="token operator">&lt;</span>FunctionButton<span class="token operator">&gt;</span> functionButtons<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.functionButtons <span class="token operator">=</span> functionButtons<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void addFunctionButton<span class="token punctuation">(</span>FunctionButton fb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			functionButtons.add<span class="token punctuation">(</span>fb<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void removeFunctionButton<span class="token punctuation">(</span>FunctionButton fb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			functionButtons.remove<span class="token punctuation">(</span>fb<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		public void display<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;显示窗口：&quot;</span> + this.title<span class="token punctuation">)</span><span class="token punctuation">;</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;显示功能键:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			for<span class="token punctuation">(</span>Object obj <span class="token keyword">:</span> functionButtons<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				System.out.println<span class="token variable"><span class="token punctuation">((</span><span class="token punctuation">(</span>FunctionButton<span class="token punctuation">)</span>obj<span class="token punctuation">)</span>.getName<span class="token punctuation">(</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;------------------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>功能键类：请求发送者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class FunctionButton <span class="token punctuation">{</span>
		private String name<span class="token punctuation">;</span>		//功能键名称
		private Command <span class="token function">command</span><span class="token punctuation">;</span>	//维持一个抽象命令对象的引用
		
		public FunctionButton<span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public String getName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> name<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//为功能键注入命令
		public void setCommand<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.command <span class="token operator">=</span> <span class="token function">command</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void onClick<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;点击功能键:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			command.execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>抽象命令类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public abstract class Command <span class="token punctuation">{</span>
		public abstract void execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>帮助命令类：具体命令类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class HelpCommand extends Command <span class="token punctuation">{</span>
	
		private HelpHandler hhObj<span class="token punctuation">;</span>		//维持对请求接收者的引用
		
		public HelpCommand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			hhObj <span class="token operator">=</span> new HelpHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		//命令执行方法，将调用请求者接收者的业务方法
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			hhObj.display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>最小化命令类：具体命令类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class MinimizeCommand extends Command <span class="token punctuation">{</span>
	
		private WindowHandler whObj<span class="token punctuation">;</span> 	//维持对请求接收者的引用
		
		public MinimizeCommand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			whObj <span class="token operator">=</span> new WindowHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		//命令执行方法，将调用请求接收者的业务方法
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			whObj.minimize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>窗口处理类：请求接收者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class WindowHandler <span class="token punctuation">{</span>
		public void minimize<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;将窗口最小化到托盘！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>帮助文档处理类：请求接收者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class HelpHandler <span class="token punctuation">{</span>
		public void display<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;显示帮助文档！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>XMLUtil类：读取配置文件利用反射生成对象</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class XMLUtil <span class="token punctuation">{</span>
		
		public static Object getBean<span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			try <span class="token punctuation">{</span>
				//创建文档对象
				DocumentBuilderFactory dFatory <span class="token operator">=</span> DocumentBuilderFactory.newInstance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				DocumentBuilder builder <span class="token operator">=</span> dFatory.newDocumentBuilder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				Document doc<span class="token punctuation">;</span>
				doc <span class="token operator">=</span> builder.parse<span class="token punctuation">(</span>new File<span class="token punctuation">(</span><span class="token string">&quot;config.xml&quot;</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
				
				//获取包含类名的文本节点
				NodeList <span class="token function">nl</span> <span class="token operator">=</span> doc.getElementsByTagName<span class="token punctuation">(</span><span class="token string">&quot;className&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				Node classNode <span class="token operator">=</span> null<span class="token punctuation">;</span>
				if<span class="token punctuation">(</span>0 <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					classNode <span class="token operator">=</span> nl.item<span class="token punctuation">(</span>0<span class="token punctuation">)</span>.getFirstChild<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>else <span class="token punctuation">{</span>
					classNode <span class="token operator">=</span> nl.item<span class="token punctuation">(</span>1<span class="token punctuation">)</span>.getFirstChild<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				
				String cName <span class="token operator">=</span> classNode.getNodeValue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				//通过类名生产实例对象并将其返回
				Class c <span class="token operator">=</span> Class.forName<span class="token punctuation">(</span>cName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Object obj <span class="token operator">=</span> c.newInstance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> obj<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> null<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> 
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置文件</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	<span class="token operator">&lt;</span>?xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>?<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>config<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>className<span class="token operator">&gt;</span>HelpCommand<span class="token operator">&lt;</span>/className<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>className<span class="token operator">&gt;</span>MinimizeCommand<span class="token operator">&lt;</span>/className<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/config<span class="token operator">&gt;</span>
</code></pre></div><p><strong>客户端</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class Client <span class="token punctuation">{</span>
		public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			FBSettingWindow fbsw <span class="token operator">=</span> new FBSettingWindow<span class="token punctuation">(</span><span class="token string">&quot;功能键设置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			FunctionButton fb1, fb2<span class="token punctuation">;</span>
			fb1 <span class="token operator">=</span> new FunctionButton<span class="token punctuation">(</span><span class="token string">&quot;功能键1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fb2 <span class="token operator">=</span> new FunctionButton<span class="token punctuation">(</span><span class="token string">&quot;功能键2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			Command command1, command2<span class="token punctuation">;</span>
			//通过读取配置文件和反射生成具体命令对象
			command1 <span class="token operator">=</span> <span class="token punctuation">(</span>Command<span class="token punctuation">)</span>XMLUtil.getBean<span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
			command2 <span class="token operator">=</span> <span class="token punctuation">(</span>Command<span class="token punctuation">)</span>XMLUtil.getBean<span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			//将命令对象注入功能键
			fb1.setCommand<span class="token punctuation">(</span>command1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			fb2.setCommand<span class="token punctuation">(</span>command2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			fbsw.addFunctionButton<span class="token punctuation">(</span>fb1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			fbsw.addFunctionButton<span class="token punctuation">(</span>fb2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			fbsw.display<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			//调用功能键的业务方法
			fb1.onClick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fb2.onClick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>如果需要修改功能键的功能，例如某个功能可以实现‘自动截屏’，只需要对应增加一个新的具体命令类，在该命令类与屏幕处理者（ScreenHandler）之间创建一个关联关系。然后将该具体命令类的对象通过配置文件注入到某个功能键即可，原有代码无须修改，符合开闭原则。在此过程中，每一个具体命令类对应一个请求的处理者（接收者），通过向请求发送者注入不同的具体命令对象可以使得相同的发送者对应不同的接收者，从而实现‘将一个请求封装为一个对象，用不同的请求对客户进行参数化’，客户端只需要将具体命令对象作为参数注入请求发送者，无须直接操作请求的接收者。</p> <h2 id="命令队列的实现"><a href="#命令队列的实现" aria-hidden="true" class="header-anchor">#</a> 命令队列的实现</h2> <h3 id="概述-2"><a href="#概述-2" aria-hidden="true" class="header-anchor">#</a> 概述</h3> <p>有时候需要将多个请求排队，当一个请求发送者发送一个请求时，不止一个请求接收者产生响应，这些请求接收者将逐个执行业务方法，完成对请求的处理。这时就可以用命令队列来实现。</p> <h3 id="典型代码-2"><a href="#典型代码-2" aria-hidden="true" class="header-anchor">#</a> 典型代码</h3> <p>命令队列的实现方法有多种形式，其中最常用，灵活性最好的一种方式是增加一个CommandQueue类，由该类来负责存储多个命令对象，而不同的命令对象可以对应不同的请求接收者，CommandQueue类的典型代码如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	class CommandQueue<span class="token punctuation">{</span>
		
		//定义一个ArrayList来存储命令队列
		private ArrayList<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span> commands <span class="token operator">=</span> new ArrayList<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		public void addCommand<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span><span class="token punctuation">{</span>
			commands.add<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		public void removeCommand<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span><span class="token punctuation">{</span>
			commands.remove<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		//循环调用每一个命令对象的execute<span class="token punctuation">(</span><span class="token punctuation">)</span>方法
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			for<span class="token punctuation">(</span>Object <span class="token function">command</span> <span class="token keyword">:</span> commands<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token punctuation">((</span>Command<span class="token punctuation">)</span>command<span class="token punctuation">)</span>.execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>在增加命令队列类CommandQueue以后，请求发送者类Invoker将针对CommandQueue编程，代码修改如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	请求发送者
	public class Invoker <span class="token punctuation">{</span>
		private CommandQueue commandQueue<span class="token punctuation">;</span> // 维持一个CommandQueue对象的引用
		
		public Invoker<span class="token punctuation">(</span>CommandQueue commandQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.commandQueue <span class="token operator">=</span> commandQueue<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void setCommandQueue<span class="token punctuation">(</span>CommandQueue commandQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.commandQueue <span class="token operator">=</span> commandQueue<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//调用CommandQueue类的execute（）方法
		public void call<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			commandQueue.execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
</code></pre></div><p>命令队列与批处理有点类似。批处理，顾名思义，可以对一组对象（命令）进行批量处理，当一个发送者发送请求后，将有一系列接收者对请求做出响应，命令队列可以用于设计批处理应用程序，如果请求接收者的接收次序没有严格的先后次序，还可以使用多线程技术来并发调用命令对象的execute()方法，从而提高程序的执行效率。</p> <h2 id="例子：撤销操作的实现"><a href="#例子：撤销操作的实现" aria-hidden="true" class="header-anchor">#</a> 例子：撤销操作的实现</h2> <p>使用命令模式开发一个简易计算器，该计算器可以实现简单的数学运算，还可以对运算实施撤销操作</p> <h3 id="结构图-3"><a href="#结构图-3" aria-hidden="true" class="header-anchor">#</a> 结构图</h3> <p><a data-fancybox="" title="结构图" href="/pic/design/MeULcjS.png"><img src="/pic/design/MeULcjS.png" alt="结构图"></a></p> <h3 id="实现代码-2"><a href="#实现代码-2" aria-hidden="true" class="header-anchor">#</a> 实现代码</h3> <p><strong>加法类：请求接收者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class Adder <span class="token punctuation">{</span>
		
		private int num <span class="token operator">=</span> 0<span class="token punctuation">;</span>//定义初始值为0
		
		//加法操作，每次将传入的值与num做加法运算，再将结果返回
		public int add<span class="token punctuation">(</span>int value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			num +<span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">return</span> num<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>抽象命令类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public abstract class AbstractCommand <span class="token punctuation">{</span>
		public abstract int execute<span class="token punctuation">(</span>int value<span class="token punctuation">)</span><span class="token punctuation">;</span> //声明命令执行方法execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
		public abstract int undo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				//声明撤销方法undo<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>具体命令类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class AddCommand extends AbstractCommand <span class="token punctuation">{</span>
	
		private Adder adder <span class="token operator">=</span> new Adder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		private int value<span class="token punctuation">;</span>
		
		//实现抽象命令类中声明的execute<span class="token punctuation">(</span><span class="token punctuation">)</span>方法，调用加法类的加法操作
		public int execute<span class="token punctuation">(</span>int value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.value <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">return</span> adder.add<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		//实现抽象命令类中声明的undo（）方法，通过加一个相反数来实现加法的逆向操作
		public int undo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> adder.add<span class="token punctuation">(</span>-value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>计算器界面类：请求发送者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class CalculatorForm <span class="token punctuation">{</span>
		private AbstractCommand <span class="token function">command</span><span class="token punctuation">;</span>
		
		public void setCommand<span class="token punctuation">(</span>AbstractCommand command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.command <span class="token operator">=</span> <span class="token function">command</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//调用命令对象的execute（）方法执行运算
		public void compute<span class="token punctuation">(</span>int value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			int i <span class="token operator">=</span> command.execute<span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;执行运算，运算结果为：&quot;</span> + i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		//调用命令对象的undo<span class="token punctuation">(</span><span class="token punctuation">)</span>方法执行撤销
		public void undo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			int i <span class="token operator">=</span> command.undo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;执行撤销，运算结果为：&quot;</span> + i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>客户端</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class Client <span class="token punctuation">{</span>
		public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			CalculatorForm form <span class="token operator">=</span> new CalculatorForm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			AbstractCommand <span class="token function">command</span><span class="token punctuation">;</span>
			<span class="token function">command</span> <span class="token operator">=</span> new AddCommand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			form.setCommand<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span> 			//向发送者注入命令对象
			
			form.compute<span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
			form.compute<span class="token punctuation">(</span>5<span class="token punctuation">)</span><span class="token punctuation">;</span>
			form.compute<span class="token punctuation">(</span>10<span class="token punctuation">)</span><span class="token punctuation">;</span>
			form.undo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h2 id="请求日志"><a href="#请求日志" aria-hidden="true" class="header-anchor">#</a> 请求日志</h2> <p>请求日志就是将请求的历史日志记录保存下来，通常以日志文件（Log File）的形式永久存储在计算机中。很多系统都提供了日志文件，例如Windows日志文件，Oracle日志文件等，日志文件可以记录用户对系统的一些操作（例如对数据的更改）</p> <h3 id="请求日志的常用功能："><a href="#请求日志的常用功能：" aria-hidden="true" class="header-anchor">#</a> 请求日志的常用功能：</h3> <ol><li><p>一旦系统发生故障，日志文件可以为系统提供给一种恢复机制，在请求日志文件中可以记录用户对系统的每一步操作，从而让系统能够恢复到某一个特定的状态</p></li> <li><p>请求日志也可以用于实现批处理，在一个请求日志文件中可以存储一系列命令对象，例如一个命令队列</p></li> <li><p>可以将命令队列中的所有命令对象存储在一个日志文件中，每执行一个命令则从日志文件中删除一个对应的命令对象，防止因为断电或者系统重启等原因造成请求丢失，而且可以避免重新发送全部请求时造成某些命令的重复执行，只需读取请求日志文件，再继续执行文件中剩余的命令即可</p></li></ol> <p>注：在实现日志时，可以将命令对象通过序列化写到日志文件中，此时命令类必须实现java.io.Serializable接口。</p> <h2 id="例子：网站配置文件管理工具"><a href="#例子：网站配置文件管理工具" aria-hidden="true" class="header-anchor">#</a> 例子：网站配置文件管理工具</h2> <p>开发一个网站配置文件管理工具，可以通过一个可视化界面对网站配置文件进行增删改等操作，使用命令模式来设计该工具</p> <h3 id="结构图："><a href="#结构图：" aria-hidden="true" class="header-anchor">#</a> 结构图：</h3> <p><a data-fancybox="" title="结构图" href="/pic/design/Bq6p4YL.png"><img src="/pic/design/Bq6p4YL.png" alt="结构图"></a></p> <h3 id="代码实现："><a href="#代码实现：" aria-hidden="true" class="header-anchor">#</a> 代码实现：</h3> <p><strong>抽象命令类，由于需要将命令对象写入文件，因此他实现了Serializable接口</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public abstract class Command implements Serializable<span class="token punctuation">{</span>
		protected String name<span class="token punctuation">;</span>					//命令名称
		protected String args<span class="token punctuation">;</span>					//命令参数
		protected ConfigOperator configOperator<span class="token punctuation">;</span>	//维持对接收者对象的引用
		
		public Command<span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		public String getName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> name<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		public void setName<span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.name <span class="token operator">=</span> name<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		public void setConfigOperator<span class="token punctuation">(</span>ConfigOperator configOperator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.configOperator <span class="token operator">=</span> configOperator<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//声明两个抽象的执行方法execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
		public abstract void execute<span class="token punctuation">(</span>String args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		public abstract void execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>增加命令类：具体命令</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class InsertCommand extends Command <span class="token punctuation">{</span>
	
		public InsertCommand<span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		@Override
		public void execute<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.args <span class="token operator">=</span> args<span class="token punctuation">;</span>
			configOperator.insert<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		@Override
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			configOperator.insert<span class="token punctuation">(</span>this.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>修改命令类：具体命令</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class ModifyCommand extends Command <span class="token punctuation">{</span>
	
		public ModifyCommand<span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			super<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		@Override
		public void execute<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.args <span class="token operator">=</span> args<span class="token punctuation">;</span>
			configOperator.modify<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		@Override
		public void execute<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			configOperator.modify<span class="token punctuation">(</span>this.args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置文件操作类：请求接收类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	/**
	 * 由于ConfigOperator类的对象是Command的成员对象，它
	 * 也将随Command对象一起写入文件，因此ConfigOperator也需实现Serializable接口
	 * 
	 * @author Administrator
	 *
	 */
	public class ConfigOperator implements Serializable <span class="token punctuation">{</span>
		
		public void insert<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;增加新节点：&quot;</span> + args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void modify<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;修改节点：&quot;</span> + args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		public void delete<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;删除节点：&quot;</span> + args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>配置文件设置窗口类：请求发送者</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class ConfigSettingWindow <span class="token punctuation">{</span>
		
		//定义一个集合来存储每一次操作时的命令对象
		private ArrayList<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span> commands <span class="token operator">=</span> new ArrayList<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		private Command <span class="token function">command</span><span class="token punctuation">;</span>
		
		//注入具体命令对象
		public void setCommand<span class="token punctuation">(</span>Command command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			this.command <span class="token operator">=</span> <span class="token function">command</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//执行配置文件修改命令，同时将命令对象添加到命令集合中
		public void call<span class="token punctuation">(</span>String args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			command.execute<span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
			commands.add<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//记录请求日志，生成日志文件，将命令集合写入日志文件
		public void save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			FileUtil.writeCommands<span class="token punctuation">(</span>commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		//从日志文件中提取命令集合，并循环调用每一个命令对象的execute<span class="token punctuation">(</span><span class="token punctuation">)</span>方法来实现配置文件
		//的重新设置
		public void recover<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			ArrayList list<span class="token punctuation">;</span>
			list <span class="token operator">=</span> FileUtil.readCommands<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			for<span class="token punctuation">(</span>Object obj <span class="token keyword">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token punctuation">((</span>Command<span class="token punctuation">)</span>obj<span class="token punctuation">)</span>.execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>工具类：文件操作类</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class FileUtil <span class="token punctuation">{</span>
		//将命令集合写入日志文件
		public static void writeCommands<span class="token punctuation">(</span>ArrayList commands<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			try <span class="token punctuation">{</span>
				FileOutputStream <span class="token function">file</span> <span class="token operator">=</span> new FileOutputStream<span class="token punctuation">(</span><span class="token string">&quot;config.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				//创建对象输出流用于将对象写入到文件中
				ObjectOutputStream objout <span class="token operator">=</span> new ObjectOutputStream<span class="token punctuation">(</span>new BufferedOutputStream<span class="token punctuation">(</span>file<span class="token punctuation">))</span><span class="token punctuation">;</span>
				//将对象写入文件
				objout.writeObject<span class="token punctuation">(</span>commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
				objout.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				System.out.println<span class="token punctuation">(</span><span class="token string">&quot;命令保存失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		//从日志文件中提取命令集合
		public static ArrayList readCommands<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			try <span class="token punctuation">{</span>
				FileInputStream <span class="token function">file</span> <span class="token operator">=</span> new FileInputStream<span class="token punctuation">(</span><span class="token string">&quot;config.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				//创建对象输入流用于从文件中读取对象
				ObjectInputStream objin <span class="token operator">=</span> new ObjectInputStream<span class="token punctuation">(</span>new BufferedInputStream<span class="token punctuation">(</span>file<span class="token punctuation">))</span><span class="token punctuation">;</span>
				
				//将文件中的对象读出并转换为ArrayList类型
				ArrayList commands <span class="token operator">=</span> <span class="token punctuation">(</span>ArrayList<span class="token punctuation">)</span> objin.readObject<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				objin.close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> commands<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>catch <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				System.out.println<span class="token punctuation">(</span><span class="token string">&quot;命令读取失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> null<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p><strong>客户端测试</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>	public class Client <span class="token punctuation">{</span>
		public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			ConfigSettingWindow csw <span class="token operator">=</span> new ConfigSettingWindow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//定义请求发送者
			Command <span class="token function">command</span><span class="token punctuation">;</span>	//定义命令对象
			ConfigOperator co <span class="token operator">=</span> new ConfigOperator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	//定义请求接收者
			
			//4次对配置文件的更改
			<span class="token function">command</span> <span class="token operator">=</span> new InsertCommand<span class="token punctuation">(</span><span class="token string">&quot;增加&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			command.setConfigOperator<span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.setCommand<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.call<span class="token punctuation">(</span><span class="token string">&quot;网站首页&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token function">command</span> <span class="token operator">=</span> new ModifyCommand<span class="token punctuation">(</span><span class="token string">&quot;修改&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			command.setConfigOperator<span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.setCommand<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.call<span class="token punctuation">(</span><span class="token string">&quot;网站首页&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;保存配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			System.out.println<span class="token punctuation">(</span><span class="token string">&quot;恢复配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			csw.recover<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h2 id="宏命令"><a href="#宏命令" aria-hidden="true" class="header-anchor">#</a> 宏命令</h2> <p>宏命令（Macro Command）又称为组合命令，它是组合模式和命令模式联用的产物。宏命令是一个具体命令类，它拥有一个集合属性，在该集合中包含了对其他命令对象的引用。通常宏命令不直接与请求接收者交互，而是通过它的成员来调用接收者的方法。当调用宏命令的execute()方法时，将递归调用它所包含的每个成员命令的execute()方法，一个宏命令的成员可以是简单命令，还可以继续是宏命令。执行一个宏命令将触发多个具体命令的执行，从而实现对命令的批处理</p> <h3 id="结构图-4"><a href="#结构图-4" aria-hidden="true" class="header-anchor">#</a> 结构图</h3> <p><a data-fancybox="" title="结构图" href="/pic/design/j0e20jr.png"><img src="/pic/design/j0e20jr.png" alt="结构图"></a></p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>命令模式是一种使用频率非常高的设计模式，可以将请求发送者与接收者解耦，请求发送者通过命令对象来间接引用请求接收者，使得系统具有更好的灵活性和可扩展性。在基于GUI的软件开发，无论是计算机桌面应用还是手机应用中命令模式都得以广泛应用</p> <h2 id="主要优点"><a href="#主要优点" aria-hidden="true" class="header-anchor">#</a> 主要优点</h2> <ol><li><p>降低系统的耦合度。由于请求者与接收者之间不存在直接引用，因此请求者与接收者之间实现完全解耦，相同的请求者可以对应不同的接收者，同样，相同的接收者也可以供不同的请求者使用，两者之间具有良好的独立性</p></li> <li><p>新的命令可以很容易地加入到系统中。由于增加新的具体命令类不会影响到其他类，因此增加新的具体命令类很容易，无须修改原有系统源代码甚至客户类代码，满足开闭原则</p></li> <li><p>可以比较容易地设计一个命令队列或宏命令（组合命令）</p></li> <li><p>为请求的撤销(Undo)和恢复(Redo)操作提供了一种设计和方案</p></li></ol> <h2 id="主要缺点"><a href="#主要缺点" aria-hidden="true" class="header-anchor">#</a> 主要缺点</h2> <p>命令模式的主要缺点是:使用命令模式可能会导致某些系统有过多的具体命令类。因为针对每一个对请求接收者的调用操作都需要设计一个具体命令类，因此在某些系统中可能需要提供大量的具体命令类，这将影响命令模式的使用</p> <h2 id="适用场景"><a href="#适用场景" aria-hidden="true" class="header-anchor">#</a> 适用场景</h2> <ol><li><p>系统需要将请求调用者和请求接收者解耦，使得调用者和接收者不直接交互，请求调用者无须知道接收者的存在，也无须知道接收者是谁，接收者也无须关心何时被调用</p></li> <li><p>系统需要在不同的时间指定请求，将请求排队和执行请求。一个命令对象和请求的初始调用者可以有不同的生命期，换言之，最初的请求发出者可能已经不在了，而命令对象仍然可能是活动的，可以通过该命令对象去调用请求接收者，而无须关心请求调用者的存在性，可以通过请求日志文件等机制来具体实现。</p></li> <li><p>系统需要支持命令的撤销(Undo)操作和恢复(Redo)操作</p></li> <li><p>系统需要将一组操作组合在一起形成宏命令</p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/22/2020, 12:20:37 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/design/018_ChainofResponsibilityPattern.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        职责链模式
      </a></span> <span class="next"><a href="/design/020_InterpreterPattern.html">
        解释器模式
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.193c9b61.js" defer></script><script src="/assets/js/2.be286493.js" defer></script><script src="/assets/js/35.fd8c8f14.js" defer></script>
  </body>
</html>